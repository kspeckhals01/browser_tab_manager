import{c as u}from"../assets/index-moDFIqUn.js";console.log("ðŸ”¥ login-init.ts loaded");const o=u("https://xaqhhwnuxlzdusmlsbkx.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhhcWhod251eGx6ZHVzbWxzYmt4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQxNzExNzQsImV4cCI6MjA1OTc0NzE3NH0.Axf5DzujX9HiS8OY0VSAF6x8sKIt2Xo4sLeKjmksCac",{auth:{persistSession:!0,storage:localStorage}}),n=location.search||location.hash,a=new URLSearchParams(n.startsWith("?")?n:n.slice(1)),t=a.get("code"),i=a.get("access_token"),c=a.get("refresh_token");console.log("[login] Params:",{code:t,access_token:i,refresh_token:c});(async()=>{var l;if(i&&c)console.log("[login] Using magic link tokens"),await o.auth.setSession({access_token:i,refresh_token:c});else if(t){console.log("[login] Using code exchange");const{error:r}=await o.auth.exchangeCodeForSession(t);if(r){console.error("[login] exchangeCodeForSession failed:",r.message),alert("Login failed.");return}}else{console.error("[login] No valid auth data"),document.getElementById("status").textContent="Login failed.";return}const{data:e}=await o.auth.getSession(),s=(l=e==null?void 0:e.session)==null?void 0:l.user;if(!s){alert("Login failed: No user returned.");return}console.log("[login-init] Setting loginSuccess flag"),await chrome.storage.local.set({userId:s.id,tier:"free",loginSuccess:"pending"});const g=await chrome.storage.local.get("loginSuccess");console.log("[login-init] loginSuccess stored as:",g.loginSuccess),chrome.runtime.sendMessage({type:"login-success",userId:s.id}),window.close()})();
